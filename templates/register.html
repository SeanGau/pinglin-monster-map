{% extends "base.html" %}
{% block title %}註冊{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{url_for('static', filename='css/register.css', version=GLOBAL_VERSION)}}" />
{% endblock %}

{% block body %}
<div class="container-fluid" id="form-box">
    <div class="row justify-content-center">
        <div class="col-lg-4">
            <h1 class="text-center">註冊帳號</h1>
            <p class="text-center">已有帳號？<a href="/login">點我登入</a></p>
            <form id="register-email">
                <div class="mb-2">
                    <label for="InputEmail" class="form-label">Email 電子信箱</label>
                    <input type="email" class="form-control" id="InputEmail" required>
                </div>
                <div class="row mb-3 justify-content-end">
                    <div class="col-4 d-grid">
                        <button class="btn btn-warning" type="submit">寄送驗證碼</button>
                    </div>
                    <div class="col-4 d-none" id="verify-email-code">
                        <input type="password" class="form-control" maxlength="10" placeholder="驗證碼">
                    </div>
                </div>
            </form>
            <form id="register-form">
                <div class="mb-3">
                    <label for="InputPassword1" class="form-label">登入密碼</label>
                    <input type="password" class="form-control" id="InputPassword1" maxlength="20" minlength="8"
                        required>
                </div>
                <div class="mb-3">
                    <label for="InputPassword2" class="form-label">再次輸入密碼</label>
                    <input type="password" class="form-control" id="InputPassword2" required>
                    <span style="color: red; transition: .3s;" class="d-none" id="pw-wrong">輸入錯誤</span>
                </div>
                <div class="mb-3">
                    <label for="InputName" class="form-label">顯示名稱</label>
                    <input type="text" class="form-control" id="InputName" maxlength="12" required>
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="CheckAgree" required>
                    <label class="form-check-label" for="CheckAgree">我同意<a href="#" data-bs-toggle="modal"
                            data-bs-target="#agreeModal">使用者條款</a></label>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-warning btn-lg">申請註冊</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div id="agreeModal" class="modal fade scroll-style" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title ms-4">會員條款</h4>
            </div>
            <div class="modal-body">
                <pre id="user-terms"><p class="m-0">歡迎使用「坪林巡怪地圖」，為了讓您能夠安心的使用本網站的各項服務與資訊，特此向您說明本網站的隱私權保護政策，以保障您的權益，依「個人資料保護法」（以下簡稱「個資法」）第八條第一項規定，公告下列事項，請您詳閱下列內容：

<b>一、隱私權保護政策的適用範圍</b>
隱私權保護政策內容，包括本網站如何處理在您使用網站服務時收集到的個人識別資料。隱私權保護政策不適用於本網站以外的相關連結網站，也不適用於非本網站所委託或參與管理的人員。

<b>二、個人資料的蒐集、處理及利用方式</b>
當您造訪本網站或使用本網站所提供之功能服務時，我們將視該服務功能性質，請您提供必要的個人資料，並在該特定目的範圍內處理及利用您的個人資料；非經您書面同意，本網站不會將個人資料用於其他用途。
本網站在您使用服務信箱、問卷調查等互動性功能時，會保留您所提供的姓名、電子郵件地址、聯絡方式及使用時間等。
於一般瀏覽時，伺服器會自行記錄相關行徑，包括您使用連線設備的IP位址、使用時間、使用的瀏覽器、瀏覽及點選資料記錄等，做為我們增進網站服務的參考依據，此記錄為內部應用，決不對外公佈。
為提供精確的服務，我們會將收集的問卷調查內容進行統計與分析，分析結果之統計數據或說明文字呈現，除供內部研究外，我們會視需要公佈統計數據及說明文字，但不涉及特定個人之資料。

<b>三、資料之保護</b>
本網站主機均設有防火牆、防毒系統等相關的各項資訊安全設備及必要的安全防護措施，加以保護網站及您的個人資料採用嚴格的保護措施，只由經過授權的人員才能接觸您的個人資料，相關處理人員皆簽有保密合約，如有違反保密義務者，將會受到相關的法律處分。
如因業務需要有必要委託其他單位提供服務時，本網站亦會嚴格要求其遵守保密義務，並且採取必要檢查程序以確定其將確實遵守。

<b>四、網站對外的相關連結</b>
本網站的網頁提供其他網站的網路連結，您也可經由本網站所提供的連結，點選進入其他網站。但該連結網站不適用本網站的隱私權保護政策，您必須參考該連結網站中的隱私權保護政策。

<b>五、與第三人共用個人資料之政策</b>
本網站絕不會提供、交換、出租或出售任何您的個人資料給其他個人、團體、私人企業或公務機關，但有法律依據或合約義務者，不在此限。
前項但書之情形包括不限於：
經由您書面同意。
法律明文規定。
為免除您生命、身體、自由或財產上之危險。
與公務機關或學術研究機構合作，基於公共利益為統計或學術研究而有必要，且資料經過提供者處理或蒐集者依其揭露方式無從識別特定之當事人。
當您在網站的行為，違反服務條款或可能損害或妨礙網站與其他使用者權益或導致任何人遭受損害時，經網站管理單位研析揭露您的個人資料是為了辨識、聯絡或採取法律行動所必要者。
有利於您的權益。
本網站委託廠商協助蒐集、處理或利用您的個人資料時，將對委外廠商或個人善盡監督管理之責。

<b>六、Cookie之使用</b>
為了提供您最佳的服務，本網站會在您的電腦中放置並取用我們的Cookie，若您不願接受Cookie的寫入，您可在您使用的瀏覽器功能項中設定隱私權等級為高，即可拒絕Cookie的寫入，但可能會導致網站某些功能無法正常執行 。

<b>七、隱私權保護政策之修正</b>
本網站隱私權保護政策將因應需求隨時進行修正，修正後的條款將刊登於網站上。


<b>坪林巡怪地圖運作團隊 敬上　2021.06.02</b>
</p></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-bs-dismiss="modal">關閉</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    $("#register-email").on('submit', function (e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/register/verify",
            data: JSON.stringify({ "email": $("#InputEmail").val() }),
            success: function (cb) {
                if (cb == "ok") {
                }
                else {
                    alert(cb);
                }
            },
            contentType: "application/json"
        });
        $("#verify-email-code").removeClass("d-none");
        alert("請至信箱收取驗證碼");
    });

    $("#register-form").on('submit', function (e) {
        e.preventDefault();
        if ($("#InputPassword1").val() != $("#InputPassword2").val()) {
            $("#pw-wrong").removeClass("d-none");
        }
        else if($("#InputEmail").val().length<4 || $("#verify-email-code input").val().length<4) {
            alert("請先輸入並驗證Email");
        }
        else {
            let export_data = {
                "email": $("#InputEmail").val(),
                "password": $("#InputPassword1").val(),
                "username": $("#InputName").val(),
                "code": $("#verify-email-code input").val()
            }
            $.ajax({
                type: "POST",
                url: window.location.href,
                data: JSON.stringify(export_data),
                success: function (cb) {
                    if (cb == "ok") {
                        alert("註冊成功！");
                        window.location.href = "/login";
                    }
                    else {
                        alert(cb);
                    }
                },
                contentType: "application/json"
            });
        }
    });
</script>
{% endblock %}